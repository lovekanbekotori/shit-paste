#include "SDK.h"
float m_flOldCurtime;
float m_flOldFrametime;
CMoveData m_MoveData;
int* m_pPredictionRandomSeed;



void StartPrediction(CInput::CUserCmd* pCmd) {
	C_BaseEntity *pLocal = Interfaces::g_EntityList->GetClientEntity(Interfaces::g_Engine->GetLocalPlayer());
	static bool bInit = false;
	if (!bInit) {
		m_pPredictionRandomSeed = *(int**)(U::FindPattern("client_panorama.dll", (PBYTE)"\x8B\x0D\x00\x00\x00\x00\xBA\x00\x00\x00\x00\xE8\x00\x00\x00\x00\x83\xC4\x04", "xx????x????x????xxx") + 2);
		bInit = true;
	}


	*m_pPredictionRandomSeed = pCmd->random_seed;


	m_flOldCurtime = Interfaces::g_Globals->curtime;
	m_flOldFrametime = Interfaces::g_Globals->frametime;

	Interfaces::g_Globals->curtime = pLocal->GetTickBase() * Interfaces::g_Globals->interval_per_tick;
	Interfaces::g_Globals->frametime = Interfaces::g_Globals->interval_per_tick;

	Interfaces::g_GameMovement->StartTrackPredictionErrors(pLocal);

	memset(&m_MoveData, 0, sizeof(m_MoveData));
	Interfaces::g_MoveHelper->SetHost(pLocal);
	Interfaces::g_Prediction->SetupMove(pLocal, pCmd, Interfaces::g_MoveHelper, &m_MoveData);
	Interfaces::g_GameMovement->ProcessMovement(pLocal, &m_MoveData);
	Interfaces::g_Prediction->FinishMove(pLocal, pCmd, &m_MoveData);

}

void EndPrediction(CInput::CUserCmd* pCmd) {
	C_BaseEntity *pLocal = Interfaces::g_EntityList->GetClientEntity(Interfaces::g_Engine->GetLocalPlayer());
	Interfaces::g_GameMovement->FinishTrackPredictionErrors(pLocal);
	Interfaces::g_MoveHelper->SetHost(0);

	*m_pPredictionRandomSeed = -1;

	Interfaces::g_Globals->curtime = m_flOldCurtime;
	Interfaces::g_Globals->frametime = m_flOldFrametime;
}





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































